// Main Nextflow Configuration for RawBench Modular Pipeline

// Pipeline metadata
manifest {
    name = 'RawBench Modular Pipeline'
    description = 'Modular evaluation of nanopore signal analysis components'
    version = '1.0.0'
    nextflowVersion = '>=22.04.0'
    defaultBranch = 'main'
}

// Default parameters
params {
    // Input/Output
    reference_fasta = null
    signal_files = null
    output_dir = 'results'
    
    // Component selection
    pore_model = 'uncalled4_r1041'
    segmentation_method = 'ttest'
    matching_method = 'hash'
    
    // Preset configurations  
    preset = null
    
    // Help
    help = false
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
        process.cpus = 4
        process.memory = '8 GB'
    }
    
    cluster {
        process.executor = 'slurm'
        process.queue = 'cpu_part'
        process.time = '24h'
        process.clusterOptions = '--exclude=kratos0,kratos1,kratos3,kratos[5-10]'
    }
    
    rawhash2 {
        includeConfig 'conf/rawhash2.config'
    }
}

// Process configuration
process {
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Resource defaults
    cpus = 4
    memory = '8 GB'
    time = '2h'
    
    // Container settings (if using containers)
    // container = 'rawbench/pipeline:latest'
}

// Execution reporting
timeline {
    enabled = true
    file = "${params.output_dir}/timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/report.html"
}

trace {
    enabled = true
    file = "${params.output_dir}/trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

dag {
    enabled = true
    file = "${params.output_dir}/dag.svg"
}
